<?xml version="1.0"?>
<clickhouse>
  <!-- {{ 2 * number_of_cpu_cores }} -->
  <max_concurrent_queries>4</max_concurrent_queries>
  <!--
  Lower mark cache size from 5GB to 1GB. 
  https://clickhouse.com/docs/en/operations/server-configuration-parameters/settings#mark_cache_size
  -->
  <mark_cache_size>2147483648</mark_cache_size>
  <merge_tree>
    <!--
    Choose a value between 1024 and 4096.
    The default is 8192.
    -->
    <merge_max_block_size>1024</merge_max_block_size>
    <!--
    Choose a value between 1GB and 4GB.
    The default is 150GB.
    -->
    <max_bytes_to_merge_at_max_space_in_pool>1073741824</max_bytes_to_merge_at_max_space_in_pool>
    <!--
    most of the time you won't have idle threads in the pool set this value to 0 to let merges proceed
    -->
    <number_of_free_entries_in_pool_to_lower_max_size_of_merge
    >0</number_of_free_entries_in_pool_to_lower_max_size_of_merge>
    <!--
    Next section: overriding here since background_pool_size was changed
    (should be less than the value of 'background_pool_size'*'XYZ_ratio')
    -->
    <number_of_free_entries_in_pool_to_execute_mutation>2</number_of_free_entries_in_pool_to_execute_mutation>
    <number_of_free_entries_in_pool_to_execute_optimize_entire_partition>2</number_of_free_entries_in_pool_to_execute_optimize_entire_partition>
  </merge_tree>
  <logger>
    <level>warning</level>
    <console>true</console>
  </logger>
  <!-- 
  Listen on IPv4 only as Docker has IPv6 disabled by default.
  -->
  <listen_host>0.0.0.0</listen_host>

  <!-- Stop all the unnecessary logging -->
  <query_thread_log remove="remove"/>
  <query_log remove="remove"/>
  <text_log remove="remove"/>
  <trace_log remove="remove"/>
  <metric_log remove="remove"/>
  <asynchronous_metric_log remove="remove"/>
  <session_log remove="remove"/>
  <part_log remove="remove"/>
</clickhouse>
